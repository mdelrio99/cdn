
<!DOCTYPE HTML>
<html>
<head>
	<title>POC4!</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #14688f;
		}
		textarea,
		pre {
			-moz-tab-size : 4;
			  -o-tab-size : 4;
				 tab-size : 4;
		}
		#ProcessedCode br {
			content: "";
			display: block;
			height: 2px;
		}
		.comment {
			color : #75a17f;
			font-style: italic;
		}
		.white {
			color : white;
			font-style : italic;
		}
		.optional {
			color : #CC5522;
			font-style : italic;
		}
		.header {
			font-size: 11px;
			font-weight : 600
		}
		.track:hover {
			background-color:#5ec9f7;
			cursor:pointer;
			padding-left:1px;
		}
		
		J1 {
			font-size:17px; 
			font-weight:600
		}
		J2 {
			font-size:14px; 
			font-weight:600
		}
		J3 {
			font-size:12px; 
			line-height:16px;
			font-weight:600
		}
		indent1 {
			margin-left:50px;
		}
		indent2 {
			margin-left:75px;
		}
		indent3 {
			margin-left:100px;
		}
		eg {
			border-bottom:1px solid;
			color:gray;
			font-style:italic;
		}
		.HelpPop {
			background-color:#f7f7df; 
			width:50vw; 
			height:52vh; 
			left:25vw; 
			top:30vh; 
			position:absolute; 
			border: 1px solid black; 
			font-family:verdana; 
			font-size:11px; 
			padding:8px; 
			box-shadow: 0 3px 10px rgb(100 100 150 / 50%)
		}
	</style>
	<script src="../js/7.0.4/pixi.js"></script>
	<script src="../js/soundmanager2.js"></script>
	<script src="../js/SndMngrWrapper.js"></script>


</head>
<body onkeydown="javascript:key(event);">

	<script>
//https://www.youtube.com/watch?v=5ggHKNa9-pY	Tiny basic

let NORTH = 'NORTH',
	EAST = 'EAST',
	WEST = 'WEST',
	SOUTH = 'SOUTH'
	
var gunFireObj, 
	ShotObj,
	CrashSound;
	
	var Spotlight = new PIXI.Graphics()
	var bFirstTime = true;
	var StateDOMObj;
	var bShowStateChanges = 0;
	var gProcessedCode = '';

	var soundManager;	
	var bQuiet = false;
	
	var AirplaneEngineSnd;
	
	soundManager.setup({
	  // where to find flash audio SWFs, as needed
	  url: 'snd/',
	  onready: function() {
		// SM2 is ready to play audio!
		gunFireObj = soundManager.createSound({		url: 'snd/GUN_FIRE-GoodSoundForYou-820112263.mp3',	volume: 20		});	
		ShotObj = soundManager.createSound({		url: 'snd/rat_upset.mp3', volume: 20});
		CrashSound = soundManager.createSound({		url: 'snd/crashsound.mp3', volume: 80});		
		AirplaneEngineSnd = soundManager.createSound({		id : 'AirplaneEngine', url: 'snd/short-airplane.mp3',	volume: 20, onfinish:function() { 
                             soundManager.play('AirplaneEngine'); 
							}})
		}
	});

	
var DarkSmokeImage = "assets/darksmoke.png"
var WhiteSmokeImage = "assets/whitepuff.png"

var MaxBullets = 20; //70	

const app = new PIXI.Application({ background: '#14688f' });
document.body.appendChild(app.view);


//const container = new PIXI.Container();

var airplane, player_tank;
var airplaneContainer,
	playerContainer;

var AmmoList = new Array();

var gActiveID = 0;

var gStopGame = false;
var gTrackingSpotlight = false;

var Sprites = new Array();
var SpriteContainers = new Array();
var Enemies = new Array();
var SmokeOntheField = new Array();
	
//--------------------------------------------------------------------------------------------------------------------------------
														setTimeout( () => { StartGame() }, 20);
//--------------------------------------------------------------------------------------------------------------------------------

var StatisticsText;



function GameLoop(delta)
{
//	console.log(delta);
//	document.getElementById("RawCode").innerHTML = delta;
	
	gticks++;
	
	if (gStopGame) return;
	

	if (airplaneContainer.energybar.Energy>0) {
		airplaneContainer.energybar.Energy-= 0.0001;
		if (airplaneContainer.energybar.Energy<0.5) {
			airplaneContainer.energybar.tint = (airplaneContainer.energybar.Energy<0.20) ? 0xff0000 : 0xffff00;
		}
		airplaneContainer.energybar.scale.x = airplaneContainer.energybar.Energy;

//		Lastairplane.rotation -= 0.01 * delta;
		airplane.rotation -= 0.0035 * delta;		
		
		var Deltas = GetXYVelocityFromDirection(airplane.rotation);
		airplaneContainer.position.x += Deltas.x;
		airplaneContainer.position.y += Deltas.y;
	} else
		GameSndManager.stop('AirplaneEngine');	


	if (gTrackingSpotlight) {
		Spotlight.position.x = cursor_x;
		Spotlight.position.y = cursor_y;
	} else {
		Spotlight.position.x = -100;
		Spotlight.position.y = -100;
	}

	
	for (i=0; i<SmokeOntheField.length; i++) {
		var smoke = SmokeOntheField[i];
		
		UpdateSmoke(smoke);
		if (smoke.alpha<=0.0) {
			app.stage.removeChild(smoke);
			SmokeOntheField.splice(i, 1);
			i--;
		}
	}
	
	for (var i = 0; i < AmmoList.length; i++) {
		var Ammo = AmmoList[i];
		
		var DistanceToObj = ComputeRealDistance(playerContainer.position, Ammo.position);
		if (Ammo.radius + player_tank.radius>DistanceToObj && 0) {		
			{
				if (!bQuiet) CrashSound.play();
				var R1 = playerContainer.position;
				var R2 = Ammo.position;
				var position = {x : (R1.x + R2.x)/2, y: (R1.y + R2.y)/2 };
				
				smoke = NewSmoke(null, position, null, false, false);
				smoke.bExplosion = false;
//				smoke.tint = QuickTint(255, 255, 255);
				var smokescale = 0.8 + RandomFloat(0.5);
				smoke.scale.x = smokescale;
				smoke.scale.y = smokescale;
				smoke.alpha = 0.5;
				smoke.scaleamount = 1.02;
			}
			
			app.stage.removeChild(Ammo);
			AmmoList.splice(i, 1);
			i--;
		} else {
		
			Ammo.rotation += 0.2;
			Ammo.position.x += Ammo.Velx;
			Ammo.position.y += Ammo.Vely;
			Ammo.life--;
			
			Ammo.alpha += Ammo.alphaChange;
			
			if (!Ammo.life || !Ammo.alpha) {
				app.stage.removeChild(Ammo);
				AmmoList.splice(i, 1);
				i--;
			}
		}
	}

	if (window.Player_Sprite_0) {
		var funcs = new Array();
		
		for (var i = 0; i< SpriteContainers.length; i++) 
			funcs.push("Player_Sprite_" + i + "(SpriteContainers[" + i + "])");
		
		geval(funcs.join(), ";");		
	}
	


//SPOTLIGHT

	if (Math.abs(airplaneContainer.position.x - cursor_x)<Spotlight.Radius && 
		Math.abs(airplaneContainer.position.y - cursor_y)<Spotlight.Radius && gTrackingSpotlight) {
		GameSndManager.rampVolume('AirplaneEngine', 100, 2.5);		
		Spotlight.tint = 0x00ff00;
	} else {
		Spotlight.tint = 0xffffff;
		GameSndManager.rampVolume('AirplaneEngine', 5, 2.5);
	}



	return;
	//fuck
	

//		player_tank.rotation += 0.005;
	
	for (var i = 0; i<airplane.weapons.length; i++) {
		airplane.weapons[i].rotation += -0.005;	
		airplane.weapons[i].rotation %=TwoPi;
	}
		
	for (var i = 0; i<player_tank.weapons.length; i++) {
		player_tank.weapons[i].rotation += 0.001;
		player_tank.weapons[i].rotation %= TwoPi;
	}
		

/*	if (!airplane.CountDownBeforeTurn) {
		airplane.rotation += 0.005;
	} else {
		airplane.CountDownBeforeTurn--;
	}*/
	
}



function StartGame()
{
	var i, j, filmstrip;

//	ShowCommands();
//return;

	LoadPageStuff();
	
//	app.stage.addChild(container);
	
//	app.stage.interactive = true;

	StateDOMObj = document.getElementById("CurState")

	var ScoreText = new PIXI.Text("Score: 0", {fontFamily: 'Arial',  fontSize: 12, fill: ['#ffffff', '#ffffff']});
	ScoreText.position.x = 10;
	ScoreText.position.y = 30;

	app.stage.addChild(ScoreText);
	
	StatisticsText = new PIXI.Text("", {fontFamily: 'Arial',  fontSize: 9, fill: ['#ffffff', '#00ff99']});
	StatisticsText.position.x = app.screen.width-30;
	StatisticsText.position.y = 30;

	app.stage.addChild(StatisticsText);



	{
		player_tank = SpriteFromTexture('assets/tank2.png');
		
		player_tank.anchor.set(0.5);
		player_tank.x = 0;//app.screen.width * 0.5;
		player_tank.y = 0;//app.screen.height * 0.5;
		player_tank.scale.x = 0.5
		player_tank.scale.y = 0.5
		player_tank.interactive = true;
		player_tank.ID = 0;
		player_tank.name = 'player_tank';
		
		Sprites.push(player_tank);

		
//		container.addChild(player_tank);
		app.stage.addChild(player_tank);

		player_tank.on('pointerdown', (event) => { 
			gActiveID = player_tank.ID 
		
			document.getElementById("RawCode").value = LoadSpriteCode( player_tank.ID ); 
		});
		
	}

	{
		var Gun = SpriteFromTexture('assets/cannon2.png')
		
		Gun.anchor.x = 0.5;
		Gun.anchor.y = 0.8;
		Gun.position.x = 0;
		Gun.position.y = -0;
		Gun.rotation = 0;
		Gun.name = 'cannon';
		Gun.WeaponLaunchMultiplier = 27;
		
		player_tank.addChild(Gun);
		player_tank.weapons = new Array();
		player_tank.weapons.push(Gun);

		player_tank.Gun = Gun;
		player_tank.radius = 100/2;
	}
	
	{
		airplane = SpriteFromTexture('assets/airplane.png');
		airplane.anchor.set(0.5);
		airplane.x = 0;//app.screen.width * 0.8;
		airplane.y = 0;//app.screen.height * 0.5;
		airplane.scale.x = 0.3
		airplane.scale.y = 0.3
		airplane.interactive = true;
		airplane.ID = 1;
		airplane.state = 'Main';		
		airplane.name = 'airplane 1';
		airplane.radius = 80/2;

		airplaneContainer = new PIXI.Container();
		airplaneContainer.x = app.screen.width * 0.8;
		airplaneContainer.y = app.screen.height * 0.5;

		airplaneContainer.addChild(airplane);
		
		airplaneContainer.energybar = new PIXI.Graphics();

		airplaneContainer.energybar.beginFill(0xffffff);
		airplaneContainer.energybar.drawRect(25, -35, 30, 5); // drawRect(x, y, width, height)
		airplaneContainer.energybar.endFill();
		airplaneContainer.energybar.alpha = 0.7;
		airplaneContainer.energybar.Energy = 1;
		airplaneContainer.energybar.tint = 0x22ff33;

		airplaneContainer.addChild(airplaneContainer.energybar);
		
		airplaneContainer.sprite = airplane;
		airplane.container = airplaneContainer;
		
		Enemies.push(airplaneContainer);
			
		app.stage.addChild(airplaneContainer);

//-------------------------------------------------------------------------------------------------
		playerContainer = new PIXI.Container();
		playerContainer.x = app.screen.width * 0.5;
		playerContainer.y = app.screen.height * 0.5;

		playerContainer.addChild(player_tank);
		playerContainer.sprite = player_tank;
		player_tank.container = playerContainer;

//		playerContainer.state = 'Main';
		ChangeState(playerContainer, 'Main')
	
		playerContainer.energybar = new PIXI.Graphics();

		playerContainer.energybar.beginFill(0xffffff);
		playerContainer.energybar.drawRect(25, -35, 30, 5); // drawRect(x, y, width, height)
		playerContainer.energybar.endFill();
		playerContainer.energybar.alpha = 0.7;
		playerContainer.energybar.Energy = 1;
		playerContainer.energybar.tint = 0x22ff33;

		playerContainer.weaponLookup = new Array();
		playerContainer.weaponLookup[Gun.name] = Gun;

		playerContainer.addChild(playerContainer.energybar);

		SpriteContainers.push(playerContainer);

		app.stage.addChild(playerContainer);
		

	}

	{
		var minigun = SpriteFromTexture('assets/minigun.png');

		minigun.position.x = -2;
		minigun.position.y = -40;
		minigun.anchor.x = 0.5;
		minigun.anchor.y = 0.8;
		minigun.scale.x = 1.2;
		minigun.scale.y = 1.2;
		minigun.name = 'minigun';
		minigun.rotation = -1.1;
		minigun.WeaponLaunchMultiplier = 12;
		
		airplane.addChild(minigun);
		airplane.Gun = minigun;
		airplane.weapons = new Array();
		airplane.weapons.push(minigun);


		airplaneContainer.weaponLookup = new Array();
		airplaneContainer.weaponLookup[minigun.name] = minigun;
	}
	
	
	
	
	Spotlight.Radius = 120;
	Spotlight.beginFill(0xffffff); 
	Spotlight.drawCircle(0, 0, Spotlight.Radius); 
	Spotlight.endFill();
	
	Spotlight.alpha = 0.2;
	
	app.stage.addChild(Spotlight);
	

	if (0)
	{
		var diamond = SpriteFromTexture('assets/diamond.png');
		
		diamond.anchor.set(0.5);
		diamond.x = 330;
		diamond.y = 340;
		diamond.scale.x = 0.5
		diamond.scale.y = 0.5
		
		diamond.Velx = 1;
		diamond.Vely = -0.5;
		diamond.life = 400;
		diamond.alphaChange = -0.002;

		app.stage.addChild(diamond);
		
		AmmoList.push(diamond);
	}
	


	// Move container to the center
//	container.x = app.screen.width / 2;
//	container.y = app.screen.height / 2;

	// Center bunny sprite in local container coordinates
//	container.pivot.x = container.width / 2;
//	container.pivot.y = container.height / 2;


	// Listen for animate update
	app.ticker.add((delta) => {
		GameLoop(delta);
	});
	
	setInterval(() => {
		StatisticsText.text = gticks + ' fps';
		gticks = 0;
		
	}, 1000	);

	setInterval(() => {
		FireGun(airplaneContainer, 'minigun');
	}, 10 );

/*	setInterval(() => {
		FireGun(player_tank, 'cannon');
	}, 350 );
*/
	
}	

function stop()
{
	gStopGame = true
	GameSndManager.stop('AirplaneEngine');	
}

function go()
{
	gStopGame = false
}

var a,m,t,c;

function stats()
{
	//--fuck
/*
	console.log('airplane:' + airplane.rotatio)
	console.log('minigun:' + airplane.weaponLookup['minigun'].rotatio)
	console.log('airplane.Gun:' + airplane.Gun.rotatio);
	console.log('combined:' + (airplane.rotatio + airplane.weaponLookup['minigun'].rotatio))
	console.log('mod 2Pi:' + (airplane.rotatio + airplane.weaponLookup['minigun'].rotatio) % TwoPi)
	console.log('----');
	console.log('tank:' + player_tank.rotatio)
	console.log('cannon:' + player_tank.weaponLookup['cannon'].rotatio)
	console.log('combined:' + (player_tank.rotatio + player_tank.weaponLookup['cannon'].rotatio))
	console.log('mod 2Pi:' + (player_tank.rotatio + player_tank.weaponLookup['cannon'].rotatio) % TwoPi)
	console.log('----');
*/	
	a = airplane;
	m = airplane.weaponLookup['minigun'];
	t = player_tank;
	c = player_tank.weaponLookup['cannon'];
}

function SpriteFromTexture(asset_path)
{
	const texture = PIXI.Texture.from(asset_path);
	return  new PIXI.Sprite(texture);
}


function LoadPageStuff()
{
	var f = function(e) {
	  if (e.key == 'Tab') {
		e.preventDefault();
		var start = this.selectionStart;
		var end = this.selectionEnd;

		// set textarea value to: text before caret + tab + text after caret
		this.value = this.value.substring(0, start) +
		  "\t" + this.value.substring(end);

		// put caret at right position again
		this.selectionStart =
		  this.selectionEnd = start + 1;
		  
	  }
	  e.cancelBubble = true;
	}
	
	document.getElementById('RawCode').addEventListener('keydown', f);
	document.getElementById('ProcessedCode').addEventListener('keydown', f);
}


var gticks = 0;

let TwoPi = Math.PI*2;


function NewSmoke(Gun, position, Deltas, bUseDarkSmoke, bExplosion)
{
	var texturePath, Smoke;
	
	if (bUseDarkSmoke) {
		texturePath = DarkSmokeImage;
	} else
		texturePath = (Gun && Gun.bDarkSmoke) ? DarkSmokeImage : WhiteSmokeImage;
		
	Smoke = SpriteFromTexture(texturePath)

	if (Deltas && !bExplosion) {
		Smoke.position.x = position.x + Deltas.x * 10;
		Smoke.position.y = position.y + Deltas.y * 10;
	} else {
		Smoke.position.x = position.x;
		Smoke.position.y = position.y;
	}
	Smoke.anchor.x = 0.5;
	Smoke.anchor.y = 0.5;
	Smoke.scale.x = 0.07;
	Smoke.scale.y = 0.07;
	Smoke.rotation = RandomFloat(Math.PI);
	Smoke.alpha = (Gun && Gun.bDarkSmoke) ? 0.75 : 0.60;
	if (Gun && Gun.smokealpha)
		Smoke.alpha = Gun.smokealpha;
		
	Smoke.direction = Deltas;	
	Smoke.scaleamount = 1.12;
	Smoke.alphaChange = -0.01;
	Smoke.rotationAmount = -RandomFloat(0.03) + 0.015;
	
	if (Gun) {
		Smoke.movement = (Gun.smokemovement) ? Gun.smokemovement : 5;
	} else {
		Smoke.movement = 3;
	}
	
//	stage.addChild(Smoke);
	app.stage.addChild(Smoke);
	SmokeOntheField.push(Smoke);
	
	return Smoke;
}



function UpdateSmoke(smoke) {
	smoke.alpha += smoke.alphaChange;
	smoke.scale.x *= smoke.scaleamount;
	smoke.scale.y *= smoke.scaleamount;
	
	if (!smoke.bExplosion) {
		if (smoke.scaleamount>1.01)
			smoke.scaleamount *= 0.9965;
	} else {
		if (smoke.scaleamount>1.01)
			smoke.scaleamount *= 0.991;
	}
	if (smoke.alphaChange>-0.00000001)
		smoke.alphaChange *= 0.2;
	
	if (smoke.direction) {
		smoke.position.x += smoke.direction.x * smoke.movement;
		smoke.position.y += smoke.direction.y * smoke.movement;
	}
	if (smoke.movement>1)
		smoke.movement *= 0.971;	//air resistance
		
	smoke.rotation += smoke.rotationAmount;
	
}	


function GetXYVelocityFromDirection(angle)
{
	return {x:Math.sin(angle), y:-Math.cos(angle)};
}


function DetermineNewRotationAngle(newHeading, curHeading)
{
	if (Math.abs(newHeading - curHeading) < Math.abs(newHeading - (curHeading + TwoPi))) {
		if (Math.abs(newHeading - curHeading) < Math.abs(newHeading - (curHeading - TwoPi))) {
			return curHeading;
		} else {
			return curHeading - TwoPi;
		}
	} else {
		return curHeading + TwoPi;
	}
}


function RandomInt(range)
{
	return Math.floor(Math.random() * range);
}

function RandomFloat(range)
{
	return (Math.random() * range);
}

var  gRandIndex = 0;

/*
function RandomFloat(range)
{
	gRandIndex++;
	if (gRandIndex>=RandomNumbers.length)
		gRandIndex = 0;
	return RandomNumbers[gRandIndex] * range;
}
*/

/*
function RandomFloat(range)
{
	return RandomNumbers[ range][++gRandIndex & IndexMask ] ;
}
*/




document.onmousemove = function(e){
    cursorX = e.pageX;
    cursorY = e.pageY;
	
}

var gLastBunny = 0, gConsecShots =0, gLastBulletLength;
var Messages = new Array();

function Message(s, x, y, r, decayRate, scaleChange, color)
{
	var Msg, undefined;
	
	if (scaleChange==undefined)		scaleChange = 0;
	if (r==undefined)				r = 0;
	if (color==undefined)			color = "blue";
	if (decayRate==undefined)		decayRate = 0.015;

		
	Msg = new PIXI.Text(s, {font:"bold 32px Arial", fill:color});
	Msg.anchor.x = 0.5;
	Msg.anchor.y = 0.5;
	Msg.position.x = x;
	Msg.position.y = y;
	Msg.r = r;
	Msg.scaleChange = scaleChange;
	Msg.decayRate = 0.015;
	
	stage.addChild(Msg);
	
	Messages.push(Msg);

//	console.log(s);
}


document.onmousedown = function(e){


}

var HelpShowing = 0;

function ShowCommands()
{
	HelpShowing = !HelpShowing;
	
	document.getElementById('helpId').style.display = (HelpShowing) ? "" : "none";
	
	if (!HelpShowing) {
		if (Pinned) {
			Pinned = false;
			HideHelp(lastHelp);
		}
	}
}


function key(event)
{

	switch (event.key) {
		case 'c' :
			stop();
			ShowCommands();
			break;

		case 's' :
			stop();
			break;
			
		case 'e' :
			
			var RawCodeObj = document.getElementById("RawCode");
			
			if (RawCodeObj.style.left == '3vw') {
				stop();
				
				RawCodeObj.style.top = '10vh'
				RawCodeObj.style.left = '10vw'
				RawCodeObj.style.width = '80vw';
				RawCodeObj.style.height = '80vh';
				
				document.getElementById("ProcessedCode").style.display = "none"
			} else {
				RawCodeObj.style.top = '70vh'
				RawCodeObj.style.left = '3vw'
				RawCodeObj.style.height = "15vh"
				RawCodeObj.style.width = "23vw"
				
				document.getElementById("ProcessedCode").style.display = ""
			}
		break;
		case 'f' :
			
			var ProcessedCodeObj = document.getElementById("ProcessedCode");
			
			if (ProcessedCodeObj.style.left == '30vw') {
				stop();
				
				ProcessedCodeObj.style.top = '10vh'
				ProcessedCodeObj.style.left = '10vw'
				ProcessedCodeObj.style.width = '80vw';
				ProcessedCodeObj.style.height = '80vh';
			} else {
				ProcessedCodeObj.style.top = '70vh'
				ProcessedCodeObj.style.left = '30vw'
				ProcessedCodeObj.style.height = "18vh"
				ProcessedCodeObj.style.width = "43vw"
			}
		break;
	}
//	stage.visible = !stage.visible;
}

	</script>
	
	
	<script>
	//-----------language stuff--------------//
	
	function Indent(Code)
	{
		return '\t' + Code.replace(/\n/g, "\n\t");
	}
	
	function GetVariableList(Code)
	{
		var EqualList = Code.split("=");
		
		for (var i = 0; i<EqualList.length-1; i++) {
			if (EqualList[0].indexOf("(")>=0) {
				var LinesOfCode = EqualList[0].split('\n');
//				console.log("WOW" + LinesOfCode.length)
//				console.log("%%%" + EqualList[0] + "%%%%");
//				console.log("$$$" + LinesOfCode[LinesOfCode.length-1].split("(")[1] + "$$$");
				
				if (LinesOfCode.length)
					return LinesOfCode[LinesOfCode.length-1].split("(")[1];
				else
					return EqualList[0].split("(")[1];
			}
			
			return EqualList[0];
		}
		return "__nothing_used";
	}
	
	//gamefuncs
	function ParameterizeWithGameObj(Code)
	{
		return 	Code.replace(/Sensor\(/g, "Sensor(GameObj, ")
					.replace(/AimTank\(/g, "AimTank(GameObj, ")
					.replace(/AimGun\(/g, "AimGun(GameObj, ")
					.replace(/IsWithinRange\(/g, "IsWithinRange(GameObj, ")
					.replace(/FireGun\(/g, "FireGun(GameObj, ")
					.replace(/Move\(/g, "Move(GameObj, ")
					.replace(/GoFor\(/g, "GoFor(GameObj, ")
					
	}
	
	function DoBusyStuff(GameObj)
	{
		if (GameObj.isBusy) {
			if (GameObj.BusyRotateCycles) {
				GameObj.BusyRotateCycles--;
				GameObj.sprite.rotation += GameObj.AutoRotation;
				if (!GameObj.BusyRotateCycles) 
					 GameObj.AutoRotation = 0; 
			}
			if (GameObj.BusyMoveCycles) {
				GameObj.BusyMoveCycles--;
				GameObj.position.x += GameObj.AutoMove.Velx;
				GameObj.position.y += GameObj.AutoMove.Vely;
				if (!GameObj.BusyMoveCycles) 
					GameObj.AutoMove = {Velx : 0, Vely : 0}; 
			}
		
			GameObj.isBusy = !GameObj.BusyRotateCycles && !GameObj.BusyMoveCycles;			
		}
		
		return GameObj.isBusy;
	}
	
	function StateCodeProcessing(Code)
	{
		var CodeLines = Code.split('\n');
		
		for (var i = 0; i<CodeLines.length; i++) {
			CodeLines[i] = '\t' + CodeLines[i];
			if (CodeLines[i].indexOf('GoFor(')>=0) {
				var bits = CodeLines[i].split(',');
				var EndParam = bits[2].split(')');
				
				EndParam[0] = "'" + EndParam[0].trim() + "'";
				
				bits[2] = EndParam.join(')');
				CodeLines[i] = bits.join(',');				
			}
			if (CodeLines[i].indexOf(':')>=0) {
				CodeLines[i] = '\tcase ' + "'" + CodeLines[i].replace(':', '').trim() + "' :"
				if (i>0) 
					CodeLines[i-1] = '\t\tbreak;\n' + CodeLines[i-1];
			}
		}
		
		return CodeLines.join('\n');
	}
	
	
	function ProcessCode(AutoSave)
	{
		var Code = document.getElementById("RawCode").value.trim();
		
		var NewCode = "function Player_Sprite_" + gActiveID + "(GameObj)\n" + 
				"{\n" 
				
		NewCode += Indent("var " + GetVariableList(Code) + ";\n") + "\n";
		
		NewCode += "\n\tif (DoBusyStuff(GameObj)) return;\n\n"		

		
//		NewCode += '\n' + '\tconsole.log(GameObj)\n\n';
		
		NewCode += '\tswitch (GameObj.state) {\n';
		
//		NewCode += "console.log('hello');\n";
		NewCode += Indent(ParameterizeWithGameObj(StateCodeProcessing(Code))) + "\n\tbreak;\n"
		
		NewCode += '\n\t}\n}\n';


		{
			document.getElementById("ProcessedCodeArea").style.display = "";
			gProcessedCode = NewCode;
			document.getElementById("ProcessedCode").innerHTML = NewCode.replace(/\n\n/g, "\n&nbsp;\n").replace(/\n/g, "<br>").replace(/\t/g, "&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\/\*/g, "<span class='comment'>/*").replace(/\*\//g, "*/</span>")
		}

		if (AutoSave)
			SaveSpriteCode(gActiveID, Code);
			
		gbIgnoreClick = true;
	}


	function SaveSpriteCode( ID, Code)
	{
		localStorage.setItem('Player_Sprite_' + ID, Code);
		console.log("Saving Code")
	}
	
	
	function LoadSpriteCode( ID )
	{
		return localStorage.getItem('Player_Sprite_' + ID);
	}
	
	
	function Sensor(GameObj, method, SeekingWhat) 
	{
///		console.log("Sensor running..." + method + " " + SeekingWhat);
		
		if (SeekingWhat=='enemy')
			return Enemies[0];
			
		if (SeekingWhat=='incoming ammo' && AmmoList.length) { //fuck
			var BestDist = 1000000.;
			var BestIndex = 0;
			var GamePos = GameObj.position;
			
			for (var i = 0; i<AmmoList.length; i++) {
				var ammoPos = AmmoList[i].position;
				var X = (ammoPos.x - GamePos.x);
				var X2 = X * X;
				var Y = (ammoPos.y - GamePos.y);
				var Y2 = Y * Y;
				FakeDist = X2 + Y2;
				if (FakeDist<BestDist) {
					BestDist = FakeDist;
					BestIndex = i;
				}
			}
			if (!AmmoList[BestIndex].Distance2)
				AmmoList[BestIndex].Distance2 = new Array();
			AmmoList[BestIndex].Distance2[GameObj.sprite.name] = BestDist;//squared
			
			return AmmoList[BestIndex];
		}
			
		return 0;
	}
	
	
	function AimTank(GameObj, direction, ToWhat) 
	{
		var XDelta, YDelta;
		var alpha;
		
		if (direction.toLowerCase() =='compass') {
			switch (ToWhat) {
				case NORTH :	alpha = 0;				break;
				case WEST :		alpha = TwoPi/4;		break;
				case SOUTH :	alpha = TwoPi/2;		break;
				case EAST :		alpha = TwoPi * 0.75;	break;
			}

			var CurRotation = GameObj.sprite.rotation;
			var NewRotation = (TwoPi - alpha) % TwoPi;

			if (CurRotation<0)
				CurRotation += TwoPi;
			if (NewRotation<0)
				NewRotation += TwoPi;
				
			if (Math.abs(NewRotation-CurRotation) <= Math.PI) {
				if (NewRotation>CurRotation)
					RotationDelta = 0.013;
				else
					RotationDelta = -0.013;
			} else {
				if (NewRotation>CurRotation)
					RotationDelta = -0.013;
				else
					RotationDelta = 0.013;
			}
			
			GameObj.sprite.rotation += RotationDelta;
			GameObj.sprite.rotation %= TwoPi;
		} else {
			XDelta = ToWhat.position.x - GameObj.position.x;
			YDelta = - (ToWhat.position.y - GameObj.position.y);
			
	//		console.log("Aiming Tank..." + direction + " " + ToWhat.sprite.name);
			
	//		console.log(XDelta + ',' + YDelta);
			
			alpha = Math.atan(YDelta/XDelta);
			
			alpha -= TwoPi/4;
			
			if (XDelta<0)
				alpha += TwoPi/2;
			
			var CurRotation = GameObj.sprite.rotation;
			var NewRotation = (TwoPi - alpha) % TwoPi;

	//		console.log(alpha);
	//		GameObj.rotation = NewRotation;
			
	//		GameObj.isBusy = true;
	//		GameObj.BusyCycles = 20;
	//		GameObj.AutoRotation = -0.003;


			if (CurRotation<0)
				CurRotation += TwoPi;
			if (NewRotation<0)
				NewRotation += TwoPi;
				
			if (Math.abs(NewRotation-CurRotation) <= Math.PI) {
				if (NewRotation>CurRotation)
					RotationDelta = 0.013;
				else
					RotationDelta = -0.013;
			} else {
				if (NewRotation>CurRotation)
					RotationDelta = -0.013;
				else
					RotationDelta = 0.013;
			}
			
			GameObj.sprite.rotation += RotationDelta;
			GameObj.sprite.rotation %= TwoPi;
		}
	}
	
	function AimGun(GameObj, direction, ToWhat) 
	{
		
//		if (GameObj.Gun.isBusy) {
//			return;
//		}
		
		{
			var XDelta = ToWhat.position.x - GameObj.position.x;
			var YDelta = - (ToWhat.position.y - GameObj.position.y);
			
	//		console.log("Aiming AimGun..." + direction + " " + ToWhat.name);
			
	//		console.log(XDelta + ',' + YDelta);
			
			var alpha = Math.atan(YDelta/XDelta);
			
			alpha -= TwoPi/4;
			
			if (XDelta<0)
				alpha += TwoPi/2;
				
			var CurRotation = GameObj.sprite.Gun.rotation;
			var NewRotation = ((TwoPi - alpha) - GameObj.sprite.rotation) % TwoPi;
			var RotationDelta = 0;
			
			if (CurRotation<0)
				CurRotation += TwoPi;
			if (NewRotation<0)
				NewRotation += TwoPi;
				
			if (Math.abs(NewRotation-CurRotation) <= Math.PI) {
				if (NewRotation>CurRotation)
					RotationDelta = 0.013;
				else
					RotationDelta = -0.013;
			} else {
				if (NewRotation>CurRotation)
					RotationDelta = -0.013;
				else
					RotationDelta = 0.013;
			}
			
			GameObj.sprite.Gun.rotation += RotationDelta;
			
//			GameObj.Gun.isBusy = true;
//			GameObj.Gun.BusyCycles = 20;
//			GameObj.Gun.AutoRotation = -0.003;
		}
	}
	
	
	function ComputeRealDistance(p1, p2)
	{
		var diffx = (p1.x-p2.x);
		var diffy = (p1.y-p2.y);
		
		return Math.sqrt(diffx * diffx + diffy * diffy);
	}


	function IsWithinRange(GameObj, ToWhat, threshold)
	{
		var ObjectPos = ToWhat.position;
		var GamePos = GameObj.position;
		
		var X = (ObjectPos.x - GamePos.x);
		var X2 = X * X;
		var Y = (ObjectPos.y - GamePos.y);
		var Y2 = Y * Y;
		
		var Dist2 = X2 + Y2;

		switch (threshold) {
			case 'near' :
				return Dist2 <= (app.screen.width/6.) * (app.screen.width/6.);
			break;
		}
		return Dist2 <= (app.screen.width/2.) * (app.screen.width/2.);
	}
	
	
	function ChangeState(GameObj, NextState)
	{	
		GameObj.state = NextState;
		if (bShowStateChanges) {
			StateDOMObj.innerHTML = NextState;
		}
//		console.log(GameObj.state);
	}


	function GoFor(GameObj, timeInSecs, Speed, NextState)
	{
		Move(GameObj, 'forward', Speed);
		
		if (GameObj.inGoFor) return;
		
		GameObj.inGoFor = 1;
		
		setTimeout( () => {
			GameObj.inGoFor = 0;
			if (NextState)
				ChangeState(GameObj, NextState);
			
		}, timeInSecs * 1000);
	}

	function Move(GameObj, How, Speed)
	{
		var Deltas = GetXYVelocityFromDirection(GameObj.sprite.rotation)
		
		GameObj.isBusy = true;
		GameObj.BusyMoveCycles = 20;

		switch (Speed) {
			case 'slow' :
				Deltas.x /= 2;
				Deltas.y /= 2;
				break;
			case 'fast' :
				Deltas.x *= 1.5;
				Deltas.y *= 1.5;
				break;
		}
		
		switch (How) {
			case 'backwards' :
				Deltas.x = - Deltas.x;
				Deltas.y = - Deltas.y;
				break;
		}
			
		GameObj.AutoMove = {Velx : Deltas.x, Vely : Deltas.y};		
	}

	
	function FireGun(GameObj, WeaponToUse)
	{
		if (gStopGame) return;
		
		
		if (GameObj.weaponLookup[WeaponToUse].isBusy) {
			GameObj.weaponLookup[WeaponToUse].BusyCycles--;
			
			if (!GameObj.weaponLookup[WeaponToUse].BusyCycles)
				GameObj.weaponLookup[WeaponToUse].isBusy = false;
			return;
		}


//		console.log("Firing Gun...:" + WeaponToUse);

		{
			var diamond = SpriteFromTexture('assets/diamond.png');
			var WeaponLaunchMultiplier = GameObj.weaponLookup[WeaponToUse].WeaponLaunchMultiplier;
			
			diamond.anchor.set(0.5);
			diamond.x = GameObj.position.x;
			diamond.y = GameObj.position.y;
			diamond.scale.x = 0.5
			diamond.scale.y = 0.5
			
			
//			var Deltas = GetXYVelocityFromDirection(GameObj.rotation-GameObj.weaponLookup[WeaponToUse].rotation); //GameObj.weaponLookup[WeaponToUse].rotation
			var Deltas;
			var R1 = GameObj.sprite.rotation;
			var R2 = GameObj.weaponLookup[WeaponToUse].rotation;
			
			
//			console.log((R1 + R2) % TwoPi);
//			if (WeaponToUse=='minigun') 
				Deltas = GetXYVelocityFromDirection((R1 + R2) % TwoPi);
//			else
//				Deltas = GetXYVelocityFromDirection(GameObj.rotation + GameObj.weaponLookup[WeaponToUse].rotation)
			
//			console.log("OBJ" + R1);
//			console.log(R2);
//			console.log((R1 + R2)%TwoPi);
			
//			console.log(GameObj.weaponLookup[WeaponToUse].rotation);

//			if (Math.abs(Deltas.x)<.03 && Math.abs(Deltas.y)<.03) return;

			GameObj.weaponLookup[WeaponToUse].isBusy = true;
			GameObj.weaponLookup[WeaponToUse].BusyCycles = 100;

			diamond.Velx = Deltas.x*3;
			diamond.Vely = Deltas.y*3;
			
			diamond.position.x += diamond.Velx * WeaponLaunchMultiplier;
			diamond.position.y += diamond.Vely * WeaponLaunchMultiplier;

//			diamond.position.x += diamond.Velx * 27;
//			diamond.position.y += diamond.Vely * 27;
			
			diamond.life = 400;
			diamond.alphaChange = -0.002;
			
			diamond.name= 'diamond'
			diamond.radius = 16/2;

			IntroduceAmmo(diamond);
		}
	}


	function IntroduceAmmo(ammo)
	{
		app.stage.addChild(ammo);
		
		AmmoList.push(ammo);
	}
	
	function ToggleTrackStateChanges(obj)
	{
		bShowStateChanges = !bShowStateChanges;
		ChangeState(playerContainer, playerContainer.state);
	}
	
	var Pinned = false, lastHelp, gPossibleHelp;
	
	function ShowHelp(id)
	{
		gPossibleHelp = id;
		if (Pinned) return;

		if (id) {
			lastHelp = id;
			document.getElementById(id).style.display = "";
		}
	}

	function HideHelp(id)
	{
		if (Pinned) return;
		
		if (id)
			document.getElementById(id).style.display = "none";
		lastHelp = 0;
	}
	
	function PinIt()
	{
		if (Pinned) {
			if (lastHelp!=gPossibleHelp) {
				Pinned = false;
				HideHelp(lastHelp);
				ShowHelp(gPossibleHelp);
				Pinned = true;
			} else {
				Pinned = false;
				HideHelp(lastHelp);
			}
		} else
			Pinned = true;
			
		gbIgnoreClick = true;
	}

//--------------------------------------------------------------------------------------------------------------------

var cursor_x = -1;
var cursor_y = -1;
var gbIgnoreClick = false;

document.onmousemove = function(event)
{
	cursor_x = event.pageX;
	cursor_y = event.pageY;
}

document.onclick = function (event)
{
	if (gbIgnoreClick) {
		gbIgnoreClick = false;
		return;
	}
	
	gTrackingSpotlight = (document.body.style.cursor!='none');
	
	document.body.style.cursor = (gTrackingSpotlight) ? 'none' : 'default';

	if (bFirstTime) {
		bFirstTime = false;
		GameSndManager.play('AirplaneEngine', {volume:5});
	}
	
}

function GetMouse()
{
    return { X : cursor_x, Y: cursor_y};
}

//--------------------------------------------------------------------------------------------------------------------
	
	var geval = eval;
	
	
	function Evaluate()
	{
		var Code = gProcessedCode;//document.getElementById("ProcessedCode").innerHTML;
		var funcs = new Array();
		
		console.clear();

		geval(Code);
		
		for (var i = 0; i< SpriteContainers.length; i++) 
			funcs.push("Player_Sprite_" + i + "(SpriteContainers[" + i + "])");
		
		geval(funcs.join(), ";");		
	}

	</script>

		<div id="EditorId">
				<textarea rows=13 cols=60 spellcheck="false" style="margin-left:10px;padding:15px;font-size:10px; line-height:10px; position:absolute; left:3vw; top:70vh; width:23vw; height:15vh" id="RawCode">
Main:
	AimTank('compass', NORTH);
	GoFor(3.5, 'slow', TurnWestState);
	
TurnWestState:
	AimTank('compass', WEST);
	GoFor(3.5, 'slow', TurnSouthState);
	
TurnSouthState:
	AimTank('compass', SOUTH);
	GoFor(3.5, 'slow', TurnEastState);
	
TurnEastState:
	AimTank('compass', EAST);
	GoFor(3.5, 'slow', Main);
		
/*
	if (obj=Sensor('closest', 'enemy')) {
		AimTank('towards', obj);
	}
	if (obj=Sensor('closest', 'incoming ammo')) {
		AimGun('towards', obj);
		
		if (IsWithinRange(obj, "near")) {
			FireGun('cannon');
			Move('backwards', 'slow')
		}
	}
*/	
				</textarea>
				<button style="position:relative; top:22vh" onclick="ProcessCode(1)">Update</button>
				<button style="position:relative; top:22vh" onclick="Evaluate()">Eval</button>
			<span id="ProcessedCodeArea" spellcheck="false"  style="display:;  ">
				<div contenteditable="true" rows=17 cols=120 style="margin-left:10px;padding:5px;font-size:9.5px;line-height:9px; position:absolute; left:30vw; top:70vh; width:43vw; height:18vh; background-color:white; font-family:verdana; font-size:10px; overflow:auto" id="ProcessedCode">
				</div>
			</span>
			<div style="position:absolute; left:92vw; top:94vh; font-size:10px; font-family:verdana"><input type="checkbox" id="TrackStates" style="cursor:pointer" onclick="ToggleTrackStateChanges(this)"><label for="TrackStates" style="cursor:pointer">Show States</label><br>
			<div id="CurState" style="color:white"></div>
			</div>
		</div>
		<button style="" onclick="stop()">Stop</button><br>
		<button style="" onclick="stats()">Stats</button><br>
		<button style="" onclick="go()">Go</button><br>
		
		<div id='helpId' style="display:none; background-color:#98CDE2; width:80vw; height:82vh; left:10vw; top:10vh; position:absolute; border: 1px solid black; font-family:verdana; font-size:11px; padding:8px; 
			box-shadow: 0 3px 10px rgb(100 100 150 / 50%)" >
			<span class='header'>State management:</span>
			<div style="margin-left:10px; margin-top:5px">
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('MainLabelHelp')" onmouseleave="HideHelp('MainLabelHelp')">Main :</span> the first state; this is automatically provided<br>
			<span class="track white" onclick="PinIt()" onmouseenter="ShowHelp('LabelHelp')" onmouseleave="HideHelp('LabelHelp')">Label</span> : User-defined label<br>
			</div>
			<br>
			
			<span class='header'>Command list:</span>
			<div style="margin-left:10px; margin-top:5px">
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('SensorHelp')" onmouseleave="HideHelp('SensorHelp')">Sensor( <span class="white">range</span>, <span class="white">thing</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('FireGunHelp')" onmouseleave="HideHelp('FireGunHelp')">FireGun( <span class="white">weaponName</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('AimTankHelp')" onmouseleave="HideHelp('AimTankHelp')">AimTank( <span class="white">how</span>, <span class="white">EntityObj / Compass Direction</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('AimGunHelp')" onmouseleave="HideHelp('AimGunHelp')">AimGun( <span class="white">how</span>, <span class="white">EntityObj</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('GoForHelp')" onmouseleave="HideHelp('GoForHelp')">GoFor( <span class="white">seconds</span>, <span class="white">speed</span>, <span class="optional">nextState</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('IsWithinRangeHelp')" onmouseleave="HideHelp('IsWithinRangeHelp')">IsWithinRange( <span class="white">EntityObj</span>, <span class="white">range</span> )</span><br>
			<span class="track" onclick="PinIt()" onmouseenter="ShowHelp('MoveHelp')" onmouseleave="HideHelp('MoveHelp')">Move( <span class="white">direction</span>, <span class="white">speed</span> )</span><br>
			</div>
		</div>
		
		
		
		<div id="MainLabelHelp" class="HelpPop" style="display:none">
			<J1>Main :</J1><br>
			<br>
			<br>
			This is the primary state of the program, and is always present<br> 
			<br>
			<br>
		</div>

		<div id="LabelHelp" class="HelpPop" style="display:none">
			<J1>Label :</J1> <br>
			<br>
			User-defined alphanumeric label that must start with a letter that defines a new code block (state)<br> 
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			Main:<br>
			<indent1>if (obj=Sensor('closest', 'enemy')) {</indent1><br>
				<indent2>GoFor(2.5, 'slow', 'AttackMode');</indent2><br>
			<indent1>}</indent1><br>
					<br>
			<eg>AttackMode:</eg><br>
				<indent1>FireGun('cannon');</indent1>
				</div>
		</div>

		<div id="SensorHelp" class="HelpPop" style="display:none">
			<J1>Sensor</J1> <J2>( range, thing )</J2><br>
			<br>
			<J3>range - </j3>'closest', 'furthest', or <i>numeric</i><br>
			<J3>thing - </j3>'enemy', 'incomming ammo'<br>
			<br>
			Returns an object that matches the specified Sensor parameters<br> 
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>if (obj=<eg>Sensor('closest', 'enemy')</eg>) {</indent1><br>
				<indent2>AimTank('towards', obj);</indent2><br>
			<indent1>}</indent1><br>
					<br>
				</div>
		</div>

		<div id="FireGunHelp" class="HelpPop" style="display:none">
			<J1>FireGun</J1> <J2>( weaponName )</J2><br>
			<br>
			<J3>weaponName - </j3>'cannon', 'minigun'<br>
			<br>
			Fires the weapon (assuming it is attached) at the native firing rate of the weapon, depleting ammunition as it fires.
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>FireGun('cannon');</indent1><br>
					<br>
				</div>			
		</div>
		
		
		<div id="AimTankHelp" class="HelpPop" style="display:none">
			<J1>AimTank</J1> <J2>( how, EntityObj / Compass Direction )</J2><br>
			<br>
			<J3>weaponName - </j3>'cannon', 'minigun'<br>
			<br>
			Fires the weapon (assuming it is attached) at the native firing rate of the weapon, depleting ammunition as it fires.
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>FireGun('cannon');</indent1><br>
					<br>
				</div>			
		</div>

		<div id="AimGunHelp" class="HelpPop" style="display:none">
			<J1>AimGun</J1> <J2>( how, EntityObj )</J2><br>
			<br>
			<J3>weaponName - </j3>'cannon', 'minigun'<br>
			<br>
			Fires the weapon (assuming it is attached) at the native firing rate of the weapon, depleting ammunition as it fires.
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>FireGun('cannon');</indent1><br>
					<br>
				</div>			
		</div>

		<div id="GoForHelp" class="HelpPop" style="display:none">
			<J1>GoFor</J1> <J2>( seconds, speed, nextState )</J2><br>
			<br>
			<J3>seconds - </j3>Number of seconds (decimals allowed)<br>
			<J3>speed - </j3>slow, fast<br>
			<J3>nextState - </j3>Optional parameter, which, if specified, indicates which state to transition to next<br>
			<br>
			Fires the weapon (assuming it is attached) at the native firing rate of the weapon, depleting ammunition as it fires.
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>FireGun('cannon');</indent1><br>
					<br>
				</div>			
		</div>

		<div id="IsWithinRangeHelp" class="HelpPop" style="display:none">
			<J1>IsWithinRange</J1> <J2>( EntityObj, range )</J2><br>
			<br>
			<J3>EntityObj - </j3>'xxx'<br>
			<J3>range - </j3>'xxx'<br>
			<br>
			yyy
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>if (obj=Sensor('closest', 'incoming ammo')) {</indent1><br>
					<indent2>if (<eg>IsWithinRange(obj, "near")</eg>) {</indent2><br>
							<indent3>Move('backwards', 'slow')</indent3></br>
			<indent1>}</indent1><br>
					<br>
				</div>			
		</div>

		<div id="MoveHelp" class="HelpPop" style="display:none">
			<J1>Move</J1> <J2>( direction, speed )</J2><br>
			<br>
			<J3>direction - </j3>'forward', 'backwards'<br>
			<J3>speed - </j3>'slow', 'fast'<br>
			<br>
			yyy
			<br>
			<br>
				<div style="background:white; padding:10px">
					<J3>Example:</J3><br>
					<br>
			<indent1>Move('forward', 'slow');</indent1><br>
					<br>
				</div>			
		</div>
	</body>
</html>
